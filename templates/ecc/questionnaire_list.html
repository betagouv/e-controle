{% extends "base.html" %}
{% load static %}

{% block page_title %}
Accueil
{% endblock page_title %}


{% block page_content %}
<div class="row row-cards">
  <div class="col-lg-12">
    {% for control in controls %}
    <div class="card">
      <div class="card-status card-status-left {% cycle 'bg-blue' 'bg-red' 'bg-yellow' 'bg-purple' 'bg-green' 'bg-teal' %}"></div>
      <div class="card-header">
        <div class="card-title text-uppercase"><h4>{{ control.title }}</h4></div>
      </div>
      <div class="card-body pb-0"> <!--// opening: questionnaire_description_card_body  //-->
      <div class="table-responsive">
        <table class="table card-table table-vcenter">
          <tbody>
            {% for questionnaire in control.questionnaires.all %}
            <tr>
              <td>
                <h5 class="pb-2">{{ questionnaire.title }}</h5>
                {% if questionnaire.sent_date %}
                  <p class="font-weight-bold"><i class="dropdown-icon fe fe-send"></i> <u>Date de transmission du questionnaire</u> :
                  {{ questionnaire.sent_date|date:"l d F Y" }}
                  </p>
                {% endif %}
                {% if questionnaire.end_date %}
                  <p class="font-weight-bold"><i class="dropdown-icon fe fe-clock"></i> <u>Date de réponse souhaitée</u> :
                    {{ questionnaire.end_date|date:"l d F Y" }}
                  </p>
                {% endif %}
              </td>
              {% if user.profile.is_audited %}
              <td class="w-1">
                <a href="{{ questionnaire.url }}">
                  <button type="submit" class="fe fe-eye btn btn-primary btn-blue" title="Déposer et consulter vos réponses"> Répondre</button>
                </a>
              </td>

              {% elif user.profile.is_inspector %}
              <td class="w-1">
                <a href="{{ questionnaire.url }}">
                  <button type="submit" class="fe fe-eye btn btn-primary btn-blue" title="Consulter les réponses sur E-contrôle"> Consulter</button>
                </a>
              </td>
              <!-- <td class="w-1">
                <a href="#">
                  <button type="submit" class="fe fe-folder btn btn-primary btn-yellow" title="Explorer les réponses dans mon navigateur windows"> Explorer</button>
                </a>
              </td> -->
              {% endif %}

            </tr>
            {% endfor %}

            <tr>
              <td colspan="2">
                <div class="card card-collapsed border-0 mb-0">
                  <div class="card-header border-0 pl-0" data-toggle="card-collapse">
                    <h5 class="card-title font-weight-bold""><a href="#"><i class="dropdown-icon fe fe-users"></i>Personnes ayant accès au contrôle</a></h5>
                  </div>
                  <div class="card-body">
                    {% with control.user_profiles.inspectors as inspectors %}
                    {% if inspectors %}
                    <div class="card">
                      <div class="card-header">
                        <h3 class="card-title"><i class="fa fa-institution mr-2"></i><strong>Équipe de contrôle</strong></h3>
                      </div>
                      <div class="card-body o-auto" style="height: o-auto">
                        <ul class="list-unstyled list-separated">

                          {% for profile in inspectors %}
                          <li class="list-separated-item">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="avatar avatar-pink">{{ profile.user.first_name|first }}{{ profile.user.last_name|first }}</span>
                              </div>
                              <div class="col">
                                <a href="javascript:void(0)" class="text-inherit" title="{{ profile.organization }}">{{ profile.user.first_name }} {{ profile.user.last_name }}</a>
                                <small class="d-block item-except text-sm text-muted h-1x"><a href="mailto:{{ profile.user.email }}">{{ profile.user.email }}</a></small>
                              </div>
                            </div>
                          </li>
                          {% endfor %}

                      </div>

                    </div>
                    {% endif %}
                    {% endwith %}

                    {% with control.user_profiles.audited as audited %}
                    {% if audited %}
                    <div class="card">
                      <div class="card-header">
                        <h3 class="card-title"><i class="fe fe-user mr-2"></i><strong>Organisme controlé</strong></h3>
                      </div>
                      <div class="card-body o-auto" style="height: o-auto">
                        <ul class="list-unstyled list-separated">

                          {% for profile in audited %}
                          <li class="list-separated-item">
                            <div class="row align-items-center">
                              <div class="col-auto">
                                <span class="avatar avatar-pink">{{ profile.user.first_name|first }}{{ profile.user.last_name|first }}</span>
                              </div>
                              <div class="col">
                                <a href="javascript:void(0)" class="text-inherit" title="{{ profile.organization }}">{{ profile.user.first_name }} {{ profile.user.last_name }}</a>
                                <small class="d-block item-except text-sm text-muted h-1x"><a href="mailto:{{ profile.user.email }}">{{ profile.user.email }}</a></small>
                              </div>
                            </div>
                          </li>
                          {% endfor %}

                      </div>
                    </div>
                    {% endif %}
                    {% endwith %}
                    <div data-toggle="card-collapse" class="text-center bg-blue cursor-pointer text-white" style="cursor: pointer;"><i class="fe fe-chevron-up"></i></div>
                  </div>
                </div>

              </td>
            </tr>

          </tbody>
        </table>
      </div>
      </div>  <!--// closing: questionnaire_description_card_body  //-->
    </div>
    {% endfor %}
</div>
</div>
{% endblock page_content %}
