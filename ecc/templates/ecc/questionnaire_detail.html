{% extends "base.html" %}
{% block content %}
{% load static %}
  <div class="page">
  <div class="page-main">
    <div class="header py-4">
      <div class="container">
        <div class="d-flex">
          <a class="header-brand" href="{% url 'login' %}">
            <img src="{% static "img/logo.jpg" %}" class="header-brand-img" alt="logo">
          </a>
          <div class="d-flex order-lg-2 ml-auto">
            <div class="dropdown">
              <a href="#" class="nav-link pr-0 leading-none" data-toggle="dropdown">
                <span class="avatar" style="background-image: url(./demo/faces/female/25.jpg)"></span>
                <span class="ml-2 d-none d-lg-block">
                  <span class="text-default">{{ user.first_name }} {{ user.last_name }}</span>
                  <small class="text-muted d-block mt-1">{{ user.profile.organization }}</small>
                </span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header collapse d-lg-flex p-0" id="headerMenuCollapse">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-3 ml-auto">
            <!-- TODO: Faire la recherche
            <form class="input-icon my-3 my-lg-0">
              <input type="Search" class="form-control header-search" placeholder="Rechercher&hellip;" tabindex="1">
              <div class="input-icon-addon">
                <i class="fe fe-search"></i>
              </div>
--> 
            </form>
          </div>
          <div class="col-lg order-lg-first">
            <ul class="nav nav-tabs border-0 flex-column flex-lg-row">
              <li class="nav-item">
                <a href="#" class="nav-link active" data-toggle="dropdown"><i class="fe fe-check-square"></i>Questionnaires</a>
                <div class="dropdown-menu dropdown-menu-arrow">
                  <a href="{% url 'questionnaire-list' %}" class="dropdown-item ">Liste des questionnaires</a>
                  {% for questionnaire in questionnaires %}
                  <a href="{{ questionnaire.url }}" class="dropdown-item ">{{ questionnaire.title }}</a>
                  {% endfor %}
                </div>
              </li>
              <li class="nav-item dropdown">
                <a href="{% url 'dashboard' %}" class="nav-link"><i class="fe fe-bar-chart"></i>Tableau de suivi</a>
              </li>
              <li class="nav-item dropdown">
                <a href="{% url 'contacts' %}" class="nav-link"><i class="fe fe-at-sign"></i>Coordonnées</a>
              </li>
              <li class="nav-item">
                <a href="mailto:assistance@e-controle.beta.fr" class="nav-link"><i class="fe fe-help-circle"></i> Aide</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="my-3 my-md-5">
      <div class="container">
        <div class="page-header">
          <h1 class="page-title">
            {{ questionnaire.title }}
          </h1>
        </div>
        <div class="row row-cards">
          <div class="col-lg-4">
            <div class="row sticky">
              <div class="col-md-6 col-lg-12">
                <div class="card">
                  <div class="card-header bg-blue text-white">
                    <h4 class="card-title">Thèmes</h4>
                  </div>
                  {% for theme in themes %}
                  <table class="table card-table">
                    <tbody>
                    <tr data-id="{{ forloop.counter }}" class="theme-row">
                      <td><a href="#theme{{ forloop.counter }}">{{ forloop.counter }}. {{ theme.title }}</a></td>
                    </tr>
                   {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-8">
            {% for theme in themes %}
            <div class="card" id="theme{{ forloop.counter }}">
              <div class="card-status card-status-top bg-blue"></div>
              <div class="card-header">
                <h3 class="card-title">{{ forloop.counter }}. {{ theme.title }}</h3>
              </div>
              <div class="table-responsive">
                  <table class="table card-table table-striped table-vcenter">
                      <tbody>
                      {% for question in theme.questions.all %}
                      <tr>
                        <td class="rows p-0">
                          <div class="card card-collapsed no-glitter border-0 col-12 m-0 p-0 bg-transparent pb-2 pt-2">
                            <div class="card-header border-0">
                              <span class="stamp stamp-md bg-blue mr-3" data-toggle="card-collapse" style="cursor: pointer">{{ forloop.parentloop.counter }}.{{ forloop.counter }}</span>
                              <div class="card-text" data-toggle="card-collapse" style="cursor: pointer">{{ question.description }}<br>
                                <!-- TODO : Tags dynamique -->
                                <div class="tags">
                                  {% if forloop.parentloop.counter|divisibleby:'3' %}
                                  <span class="tag tag-azure">2 fichiers déposés
                                    <span class="tag-addon"><i class="fe fe-file"></i></span>
                                  </span>
                                  {% endif %}
                                  {% if forloop.parentloop.counter|divisibleby:'5' %}
                                  <span class="tag tag-green">Dépôt indiqué comme terminé par le contrôlé
                                      <span class="tag-addon"><i class="fe fe-check"></i></span>
                                  </span>
                                  {% endif %}
                                </div>
                              </div>
                              <div class="card-options">
                                <a href="#" class="card-options-collapse" data-toggle="card-collapse"><i class="fe fe-chevron-up"></i></a>
                              </div>
                            </div>
                            <div class="card-body">
                                {% if forloop.parentloop.counter|divisibleby:'3' %}
                                <div class="form-group">
                                    <div class="form-label">Fichiers</div>
                                    <ul>
                                      <li><a href="#">Graphique.xls</a> <a href="#" class="icon"><i class="fe fe-info" data-toggle="tooltip" title="Julie Faro, 29/11/2018, 12:55"></i></li></a></li
                                      <li><a href="#">Contrats.doc</a> <a href="#" class="icon"><i class="fe fe-info" data-toggle="tooltip" title="Julie Faro, 29/11/2018, 12:57"></i></li></a></li
                                      </div>
                                    </ul>
                                </div>
                                {% endif %}
                                {% if user.profile.is_audited %}
                                <div class="form-group">
                                    <div class="form-label">Déposer vos réponses</div>
                                    <form class="dropzone" action="{% url 'response-upload' %}" method="post" enctype="multipart/form-data">
                                      {% csrf_token %}
                                      <div class="dz-message" data-dz-message><span>Déposer vos fichiers</span></div>
                                      <input type="hidden" id="idQuestionBulletNumber" name="question_bullet_number" value="{{ forloop.parentloop.counter }}.{{ forloop.counter }}">
                                      <input type="hidden" id="idQuestionId" name="question_id" value="{{ question.id }}">
                                      <div class="fallback">
                                        <input name="file" type="file" multiple />
                                      </div>
                                    </form>
                                </div>
                                {% endif %}
                                <div class="form-group">
                                  <label class="form-label">Commentaire</label>
                                  {% if user.profile.is_audited %}
                                  <textarea class="form-control" name="example-textarea-input" rows="4" placeholder="Texte..."></textarea>
                                  {% else %}
                                  <p>
                                    La convention de partenariat a été datée et signée le 12 mars 2010 (déposer ci-joint avec une note explicative). Depuis le 1er octobre 2017, nous avons initié un groupe de travail avec l'ordonnateur afin de réviser cette convention. Nous vous adressons également les comptes rendus de ces réunions.
                                  </p>
                                  {% endif %}
                                </div>

                                {% if user.profile.is_audited %}
                                <div class="form-group">
                                 <div class="d-flex">
                                      <a href="javascript:void(0)" class="btn btn-link" data-toggle="card-collapse">Annuler</a>
                                      <button type="submit" class="btn btn-primary ml-auto" data-toggle="card-collapse">Sauvegarder</button>
                                  </div>
                                </div>
                                {% endif %}

                          </div>

                        </td>
                      </tr>
                      {% endfor %}
                      </tbody>
                    </table>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
      <footer class="footer">
        <div class="container">
          <div class="row align-items-center flex-row-reverse">
            <div class="col-12 col-lg-auto mt-3 mt-lg-0 text-right">
              <img src="{% static "img/logo-cc.jpg" %}" class="img col-3" alt="logo-cc">
              E-contrôle. Version Bêta. <a href="#">Cour des comptes / Chambres régionale et territoriale des comptes.</a>
            </div>
          </div>
        </div>
      </footer>
  </div>
</div>
{% endblock content %}
